<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Song Requests</title>
  <link rel="stylesheet" href="dock.css" />
  <script src="https://cdn.jsdelivr.net/npm/comfy.js@1.1.6/dist/comfy.min.js"></script>
</head>
<body>
  <header class="dock-header">
    <h1 class="dock-title">Song Requests</h1>
    <div class="dock-header-right">
      <div class="header-status" aria-label="Connection status">
        <span id="overlayStatus" class="status-indicator" title="Player (overlay) connection"><span class="status-dot" aria-hidden="true"></span><span class="status-label">Overlay</span></span>
        <span id="channelStatus" class="status-indicator" title="Twitch channel connection"><span class="status-dot" aria-hidden="true"></span><span class="status-label">Channel</span></span>
      </div>
      <span id="queueCount" class="queue-count">0 in queue</span>
      <button type="button" id="settingsToggle" class="header-settings-btn icon-btn" title="Settings" aria-label="Settings">‚öô</button>
    </div>
  </header>

  <div class="tabs" role="tablist">
    <button type="button" class="tab active" id="tabQueue" role="tab" aria-selected="true" aria-controls="panelQueue">Queue</button>
    <button type="button" class="tab" id="tabSpinner" role="tab" aria-selected="false" aria-controls="panelSpinner">Spin the Wheel</button>
  </div>

  <div id="panelQueue" class="tab-panel active" role="tabpanel">
    <section class="now-playing" id="nowPlayingCard">
      <h2 class="section-heading">Now Playing</h2>
      <div class="now-playing-content">
        <div class="now-playing-thumb" id="nowPlayingThumb"></div>
        <div class="now-playing-info">
          <p class="now-playing-title" id="nowPlayingTitle">‚Äî</p>
          <p class="now-playing-requested" id="nowPlayingRequestedBy">Requested by ‚Äî</p>
          <div class="progress-wrap">
            <div class="progress-bar" id="progressBar"><span class="progress-fill" id="progressFill"></span></div>
            <span class="progress-times"><span id="progressCurrent">0:00</span> / <span id="progressDuration">0:00</span></span>
          </div>
          <div class="now-playing-controls">
            <button type="button" id="stopQueue" class="icon-btn" title="Pause">Pause</button>
            <button type="button" id="startQueue" class="icon-btn" title="Play">Play</button>
            <button type="button" id="skipNext" class="icon-btn" title="Skip">Skip</button>
            <div class="volume-wrap">
              <label for="volumeSlider" class="visually-hidden">Volume</label>
              <input type="range" id="volumeSlider" min="0" max="100" value="100" />
            </div>
            <button type="button" id="showVideoToggle" class="icon-btn eye-toggle" title="Show video on overlay" aria-label="Show video on overlay" aria-pressed="false">üëÅ</button>
          </div>
        </div>
      </div>
    </section>

    <section class="add-song">
      <h2 class="section-heading">Add Song</h2>
      <div class="add-song-row">
        <input type="text" id="urlInput" placeholder="YouTube URL" aria-label="YouTube URL" />
        <button type="button" id="addUrl" class="btn-add" title="Add">+</button>
      </div>
      <div class="toolbar">
        <button type="button" id="clearQueue" class="toolbar-btn" title="Clear queue">Clear</button>
      </div>
    </section>

    <section class="queue-section">
      <h2 class="section-heading">Queue</h2>
      <ul id="queueList" class="queue-list">
        <li class="queue-empty">Queue empty</li>
      </ul>
    </section>
  </div>

  <div id="panelSpinner" class="tab-panel" role="tabpanel" hidden>
    <section class="spin-section">
      <h2 class="section-heading">Spin the Wheel</h2>
      <p class="spin-hint" id="spinHint">Add songs to the queue, then spin to pick one.</p>
      <div class="spin-wheel-wrap" id="spinWheelWrap" hidden>
        <canvas id="spinWheelCanvas" class="spin-wheel-canvas" width="240" height="240" aria-hidden="true"></canvas>
        <div class="spin-wheel-pointer" aria-hidden="true"></div>
      </div>
      <div class="spin-result" id="spinResult" hidden>
        <p class="spin-winner-label">Winner</p>
        <p class="spin-winner-title" id="spinWinnerTitle">‚Äî</p>
        <button type="button" id="spinPlayWinner" class="btn-spin">Play this song</button>
      </div>
      <button type="button" id="spinBtn" class="btn-spin" disabled>SPIN!</button>
    </section>
  </div>

  <aside id="settingsPanel" class="settings-panel" aria-hidden="true">
    <div class="settings-header">
      <h2>Settings</h2>
      <button type="button" id="settingsClose" class="icon-btn" aria-label="Close">√ó</button>
    </div>
    <div id="settingsConnectionStatus" class="settings-connection-status" role="status" aria-live="polite"></div>
    
    <div class="settings-save-bar">
      <button type="button" id="configSave" class="settings-save-btn">Save and reconnect</button>
      <button type="button" id="twitchDisconnect" class="settings-disconnect-btn">Disconnect from Twitch</button>
    </div>

    <div class="settings-panel-section">
      <h3 class="settings-section-heading">Twitch Chat</h3>
      <p class="settings-twitch-label"><span id="twitchChannelLabel">Twitch: set your channel in the field below to listen to chat.</span> <span id="twitchStatus"></span></p>
      <label for="configChannel">Twitch channel to listen to</label>
      <input type="text" id="configChannel" placeholder="your_channel" />
      <label for="configCommand">Command prefix (without !)</label>
      <input type="text" id="configCommand" placeholder="sr" />
    </div>

    <div class="settings-panel-section">
      <h3 class="settings-section-heading">Player</h3>
      <label class="settings-checkbox-label">
        <input type="checkbox" id="autoplayWhenEmptyToggle" />
        <span>Autoplay when empty</span>
      </label>
    </div>

    <div class="settings-panel-section">
      <h3 class="settings-section-heading">Now Playing Overlay</h3>
      <label for="nowPlayingPosition">Overlay position</label>
      <select id="nowPlayingPosition">
        <option value="top-left">Top Left</option>
        <option value="bottom-left">Bottom Left</option>
      </select>
      <label for="nowPlayingDisplayMode">Display mode</label>
      <select id="nowPlayingDisplayMode">
        <option value="once">Show once</option>
        <option value="always">Always on</option>
      </select>
      <p class="settings-help-text">"Show once" displays all enabled panels once then hides. "Always on" continuously cycles through enabled panels.</p>
      <label class="settings-checkbox-label">
        <input type="checkbox" id="nowPlayingShowNext" />
        <span>Show next song</span>
      </label>
      <label class="settings-checkbox-label">
        <input type="checkbox" id="nowPlayingShowAddMessage" />
        <span>Show add message</span>
      </label>
      <div class="rotation-settings">
        <label for="nowPlayingPanelDuration">Panel duration (seconds per panel)</label>
        <input type="range" id="nowPlayingPanelDuration" min="2" max="10" value="3" step="1" />
        <div class="slider-value">
          <span id="panelDurationValue">3</span> seconds
        </div>
      </div>
    </div>

    <div class="settings-panel-section">
      <h3 class="settings-section-heading">Spin the Wheel</h3>
      <label for="wheelDisplayLocation">Wheel display location</label>
      <select id="wheelDisplayLocation">
        <option value="none">None</option>
        <option value="now-playing">Now Playing Overlay</option>
        <option value="player">Player Overlay</option>
      </select>
      <p class="settings-help-text">Choose where the wheel appears when visible. Only one location can be active at a time.</p>
      <label class="settings-checkbox-label">
        <input type="checkbox" id="shuffleMode" />
        <span>Shuffle mode</span>
      </label>
      <p class="settings-help-text">When enabled, automatically spins the wheel after each song finishes and plays the winner.</p>
    </div>
  </aside>

  <div id="settingsOverlay" class="settings-overlay" aria-hidden="true"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.4/TweenMax.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/zarocknz/javascript-winwheel@master/Winwheel.min.js"></script>
  <script src="dock.js"></script>
</body>
</html>
